<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MateriKu - Penyimpanan Materi Pribadi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #FF6584;
            --accent: #36D1DC;
            --light: #F8F9FA;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --gradient: linear-gradient(135deg, var(--primary), var(--accent));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--accent));
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color:#f5f7ff; color:var(--dark); line-height:1.6; min-height:100vh; display:flex; flex-direction:column; }
        .container { width:100%; max-width:1200px; margin:0 auto; padding:0 20px; }
        header { background:var(--gradient); color:white; padding:1rem 0; box-shadow:0 4px 12px rgba(0,0,0,0.1); position:sticky; top:0; z-index:100; }
        .header-content { display:flex; justify-content:space-between; align-items:center; }
        .logo { font-size:1.8rem; font-weight:700; display:flex; align-items:center; }
        .logo i { margin-right:10px; }
        nav ul { display:flex; list-style:none; }
        nav ul li { margin-left:1.5rem; }
        nav ul li a { color:white; text-decoration:none; font-weight:500; transition:all 0.3s ease; padding:5px 10px; border-radius:20px; }
        nav ul li a:hover { background:rgba(255,255,255,0.2); }
        .btn { display:inline-block; padding:10px 20px; background:var(--gradient); color:white; border:none; border-radius:50px; cursor:pointer; font-weight:500; transition:all 0.3s ease; text-decoration:none; box-shadow:0 4px 8px rgba(0,0,0,0.1);}
        .btn:hover { transform:translateY(-2px); box-shadow:0 6px 12px rgba(0,0,0,0.15);}
        .btn-outline { background:transparent; border:2px solid var(--primary); color:var(--primary);}
        .btn-outline:hover { background:var(--primary); color:white;}
        .btn-danger { background:var(--danger);}
        .btn-edit { background:var(--warning); color:var(--dark);}
        .main-content { padding:2rem 0; flex:1; }
        .page { display:none; animation:fadeIn 0.5s ease; }
        .active { display:block; }
        .hero { text-align:center; padding:3rem 0; background:white; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.05); margin-bottom:2rem;}
        .hero h1 { font-size:2.5rem; margin-bottom:1rem; color:var(--primary);}
        .hero p { font-size:1.2rem; color:var(--gray); max-width:700px; margin:0 auto 2rem;}
        .materials-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px,1fr)); gap:20px; margin-top:2rem;}
        .material-card { background:white; border-radius:15px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.05); transition:transform 0.3s ease, box-shadow 0.3s ease; cursor:pointer; position:relative;}
        .material-card:hover { transform:translateY(-5px); box-shadow:0 10px 25px rgba(0,0,0,0.1);}
        .material-thumbnail { height:180px; overflow:hidden; background:white; display:flex; align-items:center; justify-content:center;}
        .material-thumbnail img { width:100%; height:100%; object-fit:contain; transition:transform 0.5s ease;}
        .material-card:hover .material-thumbnail img { transform:scale(1.05);}
        .material-info { padding:1.2rem;}
        .material-title { font-size:1.2rem; margin-bottom:0.5rem; color:var(--dark);}
        .material-date { color:var(--gray); font-size:0.9rem;}
        .material-actions { display:flex; justify-content:space-between; margin-top:1rem; padding-top:1rem; border-top:1px solid #eee;}
        .editor-container, .viewer-container { background:white; border-radius:15px; padding:2rem; box-shadow:0 5px 15px rgba(0,0,0,0.05); margin-bottom:2rem;}
        .form-group { margin-bottom:1.5rem;}
        .form-group label { display:block; margin-bottom:0.5rem; font-weight:500;}
        .form-control { width:100%; padding:12px 15px; border:1px solid #ddd; border-radius:10px; font-size:1rem;}
        .textarea-control { min-height:200px; resize:vertical;}
        .image-preview { max-width:100%; margin-top:1rem; border-radius:10px; overflow:hidden; display:none;}
        .image-preview img { width:100%; max-height:300px; object-fit:contain;}
        .empty-state { text-align:center; padding:3rem 1rem; color:var(--gray);}
        .empty-state i { font-size:4rem; margin-bottom:1rem; color:#ddd;}
        footer { background:var(--dark); color:white; padding:2rem 0; margin-top:3rem;}
        .footer-content { display:flex; justify-content:space-between; align-items:center;}
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
    </style>
</head>
<body>
<header>
  <div class="container header-content">
    <div class="logo"><i class="fas fa-book"></i> MateriKu</div>
    <nav>
      <ul>
        <li><a href="#" class="nav-link" data-page="home">Beranda</a></li>
        <li><a href="#" class="nav-link" data-page="materials">Materi Saya</a></li>
        <li><a href="#" class="nav-link" data-page="add-material">Tambah Materi</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="container main-content">
  <!-- Home -->
  <section id="home" class="page active">
    <div class="hero">
      <h1>Simpan dan Kelola Materi Pembelajaran Anda</h1>
      <p>Platform untuk menyimpan, mengedit, membaca materi pembelajaran kapan saja.</p>
      <a href="#" class="btn nav-link" data-page="add-material">Tambah Materi Baru</a>
    </div>
  </section>

  <!-- List -->
  <section id="materials" class="page">
    <h2>Materi Saya</h2>
    <div class="materials-grid" id="materials-list"></div>
  </section>

  <!-- Add/Edit -->
  <section id="add-material" class="page">
    <h2 id="form-title">Tambah Materi Baru</h2>
    <div class="editor-container">
      <form id="material-form">
        <input type="hidden" id="material-id">
        <div class="form-group">
          <label for="material-title">Judul Materi</label>
          <input type="text" id="material-title" class="form-control" required>
        </div>
        <div class="form-group">
          <label for="material-content">Konten Materi</label>
          <div class="toolbar">
            <button type="button" data-command="bold"><b>B</b></button>
            <button type="button" data-command="italic"><i>I</i></button>
            <button type="button" data-command="underline"><u>U</u></button>
          </div>
          <div id="material-content" class="form-control textarea-control" contenteditable="true"></div>
        </div>
        <div class="form-group">
          <label for="material-image">Unggah Gambar</label>
          <input type="file" id="material-image" accept="image/*" class="form-control">
          <div class="image-preview" id="image-preview">
            <img src="" alt="Preview Gambar">
          </div>
        </div>
        <div class="form-buttons">
          <button type="submit" class="btn" id="save-button">Simpan Materi</button>
          <a href="#" class="btn btn-outline nav-link" data-page="materials" id="cancel-button" style="display:none;">Batal</a>
        </div>
      </form>
    </div>
  </section>

  <!-- View -->
  <section id="view-material" class="page">
    <div class="viewer-container" id="material-viewer"></div>
    <a href="#" class="btn nav-link" data-page="materials">Kembali</a>
  </section>
</main>

<footer>
  <div class="container footer-content">
    <p>&copy; 2023 MateriKu</p>
  </div>
</footer>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://flccihxefysoqfmrnqgt.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZsY2NpaHhlZnlzb3FmbXJucWd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMzMyODQsImV4cCI6MjA3MjYwOTI4NH0.xd0yLzIt_sLRGl5KCJjW77oY4l6iiBEvVtnK69nhfBk";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  const MAX_FILE_SIZE = 10*1024*1024;

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.nav-link').forEach(l => {
      l.addEventListener('click', e => {
        e.preventDefault();
        showPage(l.dataset.page);
        if (l.dataset.page==='materials') loadMaterials();
        if (l.dataset.page==='add-material') resetForm();
      });
    });
    document.querySelectorAll('.toolbar button').forEach(btn=>{
      btn.addEventListener('click',()=>{document.execCommand(btn.dataset.command,false,null);});
    });
    document.getElementById('material-form').addEventListener('submit',async e=>{
      e.preventDefault();
      const id=document.getElementById('material-id').value;
      const title=document.getElementById('material-title').value;
      const content=document.getElementById('material-content').innerHTML;
      const file=document.getElementById('material-image').files[0];
      if(file && file.size>MAX_FILE_SIZE) return alert("File > 10MB");
      if(id){await updateMaterial(id,title,content,file);} else {await saveMaterial(title,content,file);}
    });
    loadMaterials();
  });

  function showPage(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');}

  async function saveMaterial(title,content,file){
    let imageUrl=null;
    if(file){
      const name=Date.now()+"-"+file.name;
      const {error:err}=await supabase.storage.from('materi').upload(name,file);
      if(err) return alert("Upload gagal:"+err.message);
      imageUrl=`${SUPABASE_URL}/storage/v1/object/public/materi/${name}`;
    }
    const {error}=await supabase.from('materials').insert([{title,content,image:imageUrl}]);
    if(error) return alert("Gagal simpan:"+error.message);
    alert("Materi disimpan!"); resetForm(); showPage('materials'); loadMaterials();
  }

  async function updateMaterial(id,title,content,file){
    let data={title,content,updated_at:new Date().toISOString()};
    if(file){
      const name=Date.now()+"-"+file.name;
      const {error:err}=await supabase.storage.from('materi').upload(name,file);
      if(err) return alert("Upload gagal:"+err.message);
      data.image=`${SUPABASE_URL}/storage/v1/object/public/materi/${name}`;
    }
    const {error}=await supabase.from('materials').update(data).eq('id',id);
    if(error) return alert("Gagal update:"+error.message);
    alert("Materi diperbarui!"); resetForm(); showPage('materials'); loadMaterials();
  }

  async function deleteMaterial(id){
    const {error}=await supabase.from('materials').delete().eq('id',id);
    if(error) return alert("Gagal hapus:"+error.message);
    alert("Materi dihapus!"); loadMaterials();
  }

  async function loadMaterials(){
    const grid=document.getElementById('materials-list'); grid.innerHTML="";
    const {data,error}=await supabase.from('materials').select('*').order('created_at',{ascending:false});
    if(error) return grid.innerHTML=`<p style="color:red">${error.message}</p>`;
    if(!data.length) return grid.innerHTML=`<div class="empty-state"><i class="fas fa-folder-open"></i><p>Belum ada materi</p></div>`;
    data.forEach(m=>{
      const date=new Date(m.created_at).toLocaleDateString('id-ID',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
      const card=document.createElement('div'); card.className='material-card';
      card.innerHTML=`
        <div class="material-thumbnail">${m.image?`<img src="${m.image}">`:`<div style="height:100%;display:flex;align-items:center;justify-content:center;background:#f0f0f0;"><i class="fas fa-file-image" style="font-size:3rem;color:#ccc;"></i></div>`}</div>
        <div class="material-info">
          <h3 class="material-title">${m.title}</h3>
          <p class="material-date">${date}</p>
          <div class="material-actions">
            <button class="btn btn-edit" onclick="editMaterial(${m.id})"><i class="fas fa-edit"></i> Edit</button>
            <button class="btn btn-danger" onclick="deleteMaterial(${m.id})"><i class="fas fa-trash"></i> Hapus</button>
          </div>
        </div>`;
      card.addEventListener('click',e=>{if(!e.target.closest('.material-actions')) viewMaterial(m);});
      grid.appendChild(card);
    });
  }

  function viewMaterial(m){
    const viewer=document.getElementById('material-viewer');
    const date=new Date(m.created_at).toLocaleDateString('id-ID',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
    viewer.innerHTML=`<h2>${m.title}</h2><p>${date}</p><div>${m.content}</div>${m.image?`<img src="${m.image}" style="max-width:100%;margin-top:1rem">`:''}`;
    showPage('view-material');
  }

  async function editMaterial(id){
    const {data,error}=await supabase.from('materials').select('*').eq('id',id).single();
    if(error) return alert(error.message);
    document.getElementById('material-id').value=data.id;
    document.getElementById('material-title').value=data.title;
    document.getElementById('material-content').innerHTML=data.content;
    if(data.image){document.querySelector('#image-preview img').src=data.image; document.getElementById('image-preview').style.display='block';}
    document.getElementById('form-title').textContent='Edit Materi';
    document.getElementById('save-button').textContent='Perbarui Materi';
    document.getElementById('cancel-button').style.display='inline-block';
    showPage('add-material');
  }

  function resetForm(){
    document.getElementById('material-form').reset();
    document.getElementById('material-id').value='';
    document.getElementById('material-content').innerHTML='';
    document.getElementById('image-preview').style.display='none';
    document.getElementById('form-title').textContent='Tambah Materi Baru';
    document.getElementById('save-button').textContent='Simpan Materi';
    document.getElementById('cancel-button').style.display='none';
  }
</script>
</body>
</html>

