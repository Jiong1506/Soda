<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MateriKu - Penyimpanan Materi Pribadi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* === CSS asli kamu di sini (aku tidak ubah desain sama sekali) === */
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background:#f5f7ff; }
    .container { width: 100%; max-width: 1200px; margin: auto; padding: 0 20px; }
    header { background: linear-gradient(135deg,#6C63FF,#36D1DC); color: #fff; padding: 1rem 0; position:sticky;top:0;z-index:100; }
    .header-content { display:flex;justify-content:space-between;align-items:center; }
    .logo { font-size:1.5rem;font-weight:bold; }
    nav ul { display:flex;list-style:none;padding:0;margin:0; }
    nav ul li { margin-left:1rem; }
    nav ul li a { color:#fff;text-decoration:none;padding:6px 12px;border-radius:20px; }
    nav ul li a:hover { background:rgba(255,255,255,0.2); }
    .btn { padding:10px 20px;border:none;border-radius:30px;cursor:pointer;font-weight:500; }
    .btn-edit { background:#ffc107;color:#000; }
    .btn-danger { background:#dc3545;color:#fff; }
    .btn-outline { border:2px solid #6C63FF;background:transparent;color:#6C63FF; }
    .btn-outline:hover { background:#6C63FF;color:#fff; }
    .main-content { padding:2rem 0; }
    .page { display:none; }
    .page.active { display:block; }
    .materials-grid { display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px; }
    .material-card { background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.05);cursor:pointer; }
    .material-thumbnail { height:180px;display:flex;align-items:center;justify-content:center;overflow:hidden;background:#f8f9fa; }
    .material-thumbnail img { width:100%;height:100%;object-fit:contain; }
    .material-info { padding:1rem; }
    .material-title { font-size:1.2rem;font-weight:bold; }
    .material-date { font-size:0.85rem;color:#666; }
    .material-actions { display:flex;justify-content:space-between;margin-top:1rem; }
    footer { background:#212529;color:#fff;padding:1rem;text-align:center;margin-top:2rem; }
  </style>
</head>
<body>
  <header>
    <div class="container header-content">
      <div class="logo"><i class="fas fa-book"></i> MateriKu</div>
      <nav>
        <ul>
          <li><a href="#" class="nav-link" data-page="home">Beranda</a></li>
          <li><a href="#" class="nav-link" data-page="materials">Materi Saya</a></li>
          <li><a href="#" class="nav-link" data-page="add-material">Tambah Materi</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container main-content">
    <!-- Home Page -->
    <section id="home" class="page active">
      <h2>Selamat datang di MateriKu</h2>
      <p>Simpan dan kelola materi pembelajaran Anda dengan mudah.</p>
      <a href="#" class="btn nav-link" data-page="add-material" style="background:linear-gradient(135deg,#6C63FF,#36D1DC);color:#fff;">Tambah Materi Baru</a>
    </section>

    <!-- Materials Page -->
    <section id="materials" class="page">
      <h2>Materi Saya</h2>
      <div class="materials-grid" id="materials-list"></div>
    </section>

    <!-- Add Material Page -->
    <section id="add-material" class="page">
      <h2 id="form-title">Tambah Materi Baru</h2>
      <form id="material-form">
        <input type="hidden" id="material-id">
        <div>
          <label for="material-title">Judul</label>
          <input type="text" id="material-title" class="form-control" required>
        </div>
        <div>
          <label for="material-content">Konten</label>
          <div id="material-content" class="form-control" contenteditable="true" style="min-height:120px;background:#fff;border:1px solid #ccc;padding:10px;"></div>
        </div>
        <div>
          <label for="material-image">Upload Gambar</label>
          <input type="file" id="material-image" accept="image/*">
        </div>
        <button type="submit" class="btn" style="background:linear-gradient(135deg,#6C63FF,#36D1DC);color:#fff;" id="save-button">Simpan Materi</button>
        <a href="#" class="btn btn-outline nav-link" data-page="materials" id="cancel-button" style="display:none;">Batal</a>
      </form>
    </section>

    <!-- View Material Page -->
    <section id="view-material" class="page">
      <div id="material-viewer"></div>
      <a href="#" class="btn nav-link btn-outline" data-page="materials">Kembali</a>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 MateriKu - Semua Hak Dilindungi</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://flccihxefysoqfmrnqgt.supabase.co";
    const SUPABASE_KEY = "sb_publishable_JL5K5fbvwtBckmto_Nu_-A_9Y-AQTsb"; 
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const MAX_FILE_SIZE = 10 * 1024 * 1024;

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', e => {
          e.preventDefault();
          showPage(link.dataset.page);
          if (link.dataset.page === 'materials') loadMaterials();
          if (link.dataset.page === 'add-material') resetForm();
        });
      });
      document.getElementById('material-form').addEventListener('submit', handleForm);
      loadMaterials();
    });

    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    async function handleForm(e) {
      e.preventDefault();
      const id = document.getElementById('material-id').value;
      const title = document.getElementById('material-title').value;
      const content = document.getElementById('material-content').innerHTML;
      const file = document.getElementById('material-image').files[0];
      if (id) {
        await updateMaterial(id, title, content, file);
      } else {
        await saveMaterial(title, content, file);
      }
    }

    async function saveMaterial(title, content, file) {
      let imageUrl = null;
      if (file) {
        if (file.size > MAX_FILE_SIZE) return alert("Ukuran file max 10MB!");
        const fileName = Date.now() + "-" + file.name;
        const { error: uploadError } = await supabase.storage.from("materi").upload(fileName, file);
        if (uploadError) return alert("Upload gagal: " + uploadError.message);
        imageUrl = `${SUPABASE_URL}/storage/v1/object/public/materi/${fileName}`;
      }
      const { error } = await supabase.from("materials").insert([{ title, content, image: imageUrl }]);
      if (error) return alert("Gagal simpan: " + error.message);
      alert("Materi berhasil disimpan!");
      resetForm(); showPage("materials"); loadMaterials();
    }

    async function updateMaterial(id, title, content, file) {
      let updateData = { title, content, updated_at: new Date().toISOString() };
      if (file) {
        if (file.size > MAX_FILE_SIZE) return alert("Ukuran file max 10MB!");
        const fileName = Date.now() + "-" + file.name;
        const { error: uploadError } = await supabase.storage.from("materi").upload(fileName, file);
        if (uploadError) return alert("Upload gagal: " + uploadError.message);
        updateData.image = `${SUPABASE_URL}/storage/v1/object/public/materi/${fileName}`;
      }
      const { error } = await supabase.from("materials").update(updateData).eq("id", id);
      if (error) return alert("Gagal update: " + error.message);
      alert("Materi diperbarui!");
      resetForm(); showPage("materials"); loadMaterials();
    }

    async function deleteMaterial(id) {
      if (!confirm("Yakin hapus materi ini?")) return;
      const { error } = await supabase.from("materials").delete().eq("id", id);
      if (error) return alert("Gagal hapus: " + error.message);
      alert("Materi dihapus!");
      loadMaterials();
    }

    async function loadMaterials() {
      const list = document.getElementById("materials-list");
      list.innerHTML = "";
      const { data: materials, error } = await supabase.from("materials").select("*").order("created_at", { ascending: false });
      if (error) return list.innerHTML = `<p style="color:red">${error.message}</p>`;
      if (!materials.length) return list.innerHTML = `<p>Belum ada materi</p>`;
      materials.forEach(m => {
        const card = document.createElement("div");
        card.className = "material-card";
        const date = new Date(m.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});
        card.innerHTML = `
          <div class="material-thumbnail">${m.image ? `<img src="${m.image}">` : `<i class="fas fa-file-image" style="font-size:3rem;color:#ccc;"></i>`}</div>
          <div class="material-info">
            <h3 class="material-title">${m.title}</h3>
            <p class="material-date">${date}</p>
            <div class="material-actions">
              <button class="btn btn-edit" onclick="editMaterial(${m.id})">Edit</button>
              <button class="btn btn-danger" onclick="deleteMaterial(${m.id})">Hapus</button>
            </div>
          </div>`;
        card.addEventListener("click", e => { if (!e.target.closest(".material-actions")) viewMaterial(m); });
        list.appendChild(card);
      });
    }

    function viewMaterial(m) {
      const viewer = document.getElementById("material-viewer");
      const date = new Date(m.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});
      viewer.innerHTML = `<h2>${m.title}</h2><p>${date}</p><hr><div>${m.content}</div>${m.image?`<img src="${m.image}" style="max-width:100%;margin-top:1rem">`:""}`;
      showPage("view-material");
    }

    async function editMaterial(id) {
      const { data, error } = await supabase.from("materials").select("*").eq("id", id).single();
      if (error) return alert(error.message);
      document.getElementById("material-id").value = data.id;
      document.getElementById("material-title").value = data.title;
      document.getElementById("material-content").innerHTML = data.content;
      document.getElementById("form-title").textContent = "Edit Materi";
      document.getElementById("save-button").textContent = "Perbarui Materi";
      document.getElementById("cancel-button").style.display = "inline-block";
      showPage("add-material");
    }

    function resetForm() {
      document.getElementById("material-form").reset();
      document.getElementById("material-id").value = "";
      document.getElementById("material-content").innerHTML = "";
      document.getElementById("form-title").textContent = "Tambah Materi Baru";
      document.getElementById("save-button").textContent = "Simpan Materi";
      document.getElementById("cancel-button").style.display = "none";
    }
  </script>
</body>
</html>
